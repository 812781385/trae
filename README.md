# Trae

> ç”¨è‡ªç„¶è¯­è¨€æ“æ§ Linux ç»ˆç«¯çš„å‘½ä»¤æµæ°´çº¿åŠ©æ‰‹ï¼Œå†…ç½®æŠ€èƒ½ã€å±é™©å‘½ä»¤é˜²æŠ¤ä¸å®Œæ•´çš„ Debian æ‰“åŒ…æµç¨‹ã€‚

æ¬¢è¿æ¥åˆ° Trae çš„å®˜æ–¹ä»“åº“ã€‚è¯¥é¡¹ç›®é€šè¿‡ LLMï¼ˆæˆ–å†…ç½®æŠ€èƒ½ï¼‰ç†è§£ä½ çš„ä¸­æ–‡/è‹±æ–‡æè¿°ï¼Œè‡ªåŠ¨è§„åˆ’å¹¶æ‰§è¡Œå®‰å…¨çš„ Linux å‘½ä»¤ï¼Œå¹¶æŠŠå…³é”®è¾“å‡ºå†™å…¥ä¸Šä¸‹æ–‡å†å²ï¼Œä»¥ä¾¿æŒç»­å¯¹è¯ã€‚

> æƒ³å¿«é€Ÿä½“éªŒï¼Ÿå‚è§ [`QUICKSTART.md`](QUICKSTART.md)ã€‚éœ€è¦äº†è§£æ‰“åŒ…æµç¨‹ï¼Ÿå‚è§ [`BUILD.md`](BUILD.md)ã€‚Looking for English docs? Read [`README.en.md`](README.en.md)ã€‚

---

## ç›®å½•

1. [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
2. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
3. [å®‰è£…æ–¹å¼](#å®‰è£…æ–¹å¼)
4. [å¿«é€Ÿä¸Šæ‰‹](#å¿«é€Ÿä¸Šæ‰‹)
5. [å‘½ä»¤è¡Œå‚æ•°](#å‘½ä»¤è¡Œå‚æ•°)
6. [é…ç½®ä¸ç¯å¢ƒå˜é‡](#é…ç½®ä¸ç¯å¢ƒå˜é‡)
7. [LLM æä¾›å•†æ”¯æŒçŸ©é˜µ](#llm-æä¾›å•†æ”¯æŒçŸ©é˜µ)
8. [å†…ç½®æŠ€èƒ½ä¸å®‰å…¨æœºåˆ¶](#å†…ç½®æŠ€èƒ½ä¸å®‰å…¨æœºåˆ¶)
9. [ä¸Šä¸‹æ–‡è®°å¿†](#ä¸Šä¸‹æ–‡è®°å¿†)
10. [æ„å»ºä¸å‘å¸ƒ](#æ„å»ºä¸å‘å¸ƒ)
11. [æµ‹è¯•ä¸è´¨é‡ä¿è¯](#æµ‹è¯•ä¸è´¨é‡ä¿è¯)
12. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
13. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
14. [è´¡çŒ®ä¸æ”¯æŒ](#è´¡çŒ®ä¸æ”¯æŒ)
15. [è®¸å¯è¯](#è®¸å¯è¯)

---

## æ ¸å¿ƒç‰¹æ€§

- ğŸ¤– **æ™ºèƒ½ç†è§£**ï¼šä¸»æµç¨‹ç”±å¤§è¯­è¨€æ¨¡å‹é©±åŠ¨ï¼Œèƒ½è§£æå¤šè½®ä¸Šä¸‹æ–‡å¹¶ç»™å‡ºå¯æ‰§è¡Œè¡ŒåŠ¨è®¡åˆ’ã€‚
- ğŸ§© **å†…ç½®æŠ€èƒ½ä¼˜å…ˆ**ï¼šå¸¸è§é—®é¢˜ï¼ˆç³»ç»Ÿé…ç½®ã€MySQL å‡­æ®æé†’ã€ç»“æœè¿½é—®ç­‰ï¼‰åœ¨æœ¬åœ°ç¦»çº¿å›ç­”ï¼Œé™ä½æˆæœ¬ä¸å»¶è¿Ÿã€‚
- âš™ï¸ **è‡ªåŠ¨æ‰§è¡Œ**ï¼šé’ˆå¯¹ `run_command` æ„å›¾è‡ªåŠ¨æ‰§è¡Œ shellï¼Œå¹¶å¯é€‰è¿”å›è‡ªç„¶è¯­è¨€æ€»ç»“ã€‚
- ğŸ›¡ï¸ **å®‰å…¨æŠ¤æ **ï¼šæ­£åˆ™æ£€æµ‹å±é™©å‘½ä»¤ï¼ˆ`rm -rf /`ã€`dd if=...`ã€`mkfs` ç­‰ï¼‰å¹¶äºŒæ¬¡ç¡®è®¤ã€‚
- ğŸ§  **ä¸Šä¸‹æ–‡è®°å¿†**ï¼šé»˜è®¤ä¿ç•™ 50 æ¡äº¤äº’ï¼Œè¾“å‡ºæŒ‰éœ€æˆªæ–­ï¼Œæ–¹ä¾¿è·Ÿè¿›â€œä¸Šä¸€æ¡å‘½ä»¤â€ã€‚
- ğŸ”Œ **å¤šæä¾›å•†**ï¼šå†…ç½® OpenAIã€Anthropicã€Qwen/DashScopeã€æœ¬åœ° Ollamaï¼›å¯æ’æ‹”æ‰©å±•ã€‚
- ğŸ“¦ **å·¥ç¨‹åŒ–**ï¼šé™„å¸¦ Debian æ‰“åŒ…è„šæœ¬ã€Makefile ä¾èµ–æ£€æµ‹ã€`setup.py`ã€man pageã€è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ã€‚

---

## æ¶æ„æ¦‚è§ˆ

| æ¨¡å— | è§’è‰² |
| --- | --- |
| `trae/main.py` | CLI å…¥å£ï¼Œè§£æå‚æ•°ã€åŠ è½½é…ç½®ã€è°ƒç”¨ `CommandAgent`ã€‚ |
| `trae/agent.py` | æ ¸å¿ƒä»£ç†ï¼šè°ƒåº¦æŠ€èƒ½ â†’ LLM è§„åˆ’ â†’ å‘½ä»¤æ‰§è¡Œ/æ€»ç»“/è®°å½•ã€‚ |
| `trae/llm_client.py` | æŠ½è±¡å¤šå®¶ LLM APIï¼Œç»Ÿä¸€ `generate(prompt)` æ¥å£ã€‚ |
| `trae/skills.py` | ç³»ç»Ÿä¿¡æ¯ã€MySQL å‡­æ®æé†’ã€ç»“æœè¿½é—®ç­‰æŠ€èƒ½æ’ä»¶ã€‚ |
| `trae/history.py` | JSONL å†å²ç®¡ç†å™¨ï¼Œè´Ÿè´£ä¸Šä¸‹æ–‡æŒä¹…åŒ–ä¸è£å‰ªã€‚ |
| `debian/` | æ§åˆ¶æ–‡ä»¶ã€man pageã€postinst ç­‰æ‰“åŒ…èµ„äº§ã€‚ |
| `test_trae.py` | ä¸ä¾èµ–çœŸå® LLM çš„å†’çƒŸæµ‹è¯•ï¼ˆé…ç½®/æŠ€èƒ½/ä¸Šä¸‹æ–‡/å®‰å…¨æ£€æµ‹ï¼‰ã€‚ |

æµç¨‹ç®€è¿°ï¼š

```text
è‡ªç„¶è¯­è¨€ -> (æŠ€èƒ½åŒ¹é…?)
    â””â”€â”€ æ˜¯ï¼šç›´æ¥è¿”å› SkillResult
    â””â”€â”€ å¦ï¼šæ„é€ è§„åˆ’æç¤ºè¯ -> LLM è¾“å‡º JSON è®¡åˆ’ -> å®‰å…¨æ£€æŸ¥ -> æ‰§è¡Œå‘½ä»¤ -> å¯é€‰æ€»ç»“ -> è®°å½•å†å²
```

---

## å®‰è£…æ–¹å¼

### 1. PPA / aptï¼ˆæ¨èï¼‰

```bash
sudo add-apt-repository ppa:wangrui9527/trae
sudo apt update
sudo apt install trae
```

### 2. ä»æºç æ„å»º Debian åŒ…

å‚ç…§ `QUICKSTART.md` çš„â€œæ–¹æ³• 1â€ã€‚æ¦‚è¦ï¼š

```bash
sudo apt update
sudo apt install devscripts debhelper python3-all python3-setuptools python3-pip dh-python

git clone https://github.com/812781385/trae.git
cd trae
make deb                         # è‡ªåŠ¨æ£€æŸ¥ä¾èµ–å¹¶è¿è¡Œ debuild
sudo dpkg -i ../trae_0.1.0_all.deb
sudo apt-get install -f          # è¡¥é½ä¾èµ–
```

### 3. å¼€å‘è€…æ¨¡å¼

```bash
git clone https://github.com/812781385/trae.git
cd trae
pip3 install -e .[openai]        # æŒ‰éœ€é™„åŠ  anthropic/qwen/all
```

> `pip install -e .` ä»…å®‰è£… Python ç«¯ä»£ç ï¼Œä¸ä¼šç”Ÿæˆ Debian åŒ…ï¼›CLI å…¥å£ä»ä¸º `trae=trae.main:main`ã€‚

---

## å¿«é€Ÿä¸Šæ‰‹

```bash
# æŸ¥è¯¢å†…å­˜
trae å¸®æˆ‘æŸ¥è¯¢å†…å­˜ä½¿ç”¨æƒ…å†µ

# å¹²è¿è¡Œï¼ˆåªçœ‹å‘½ä»¤ä¸æ‰§è¡Œï¼‰
trae --dry-run "ç»Ÿè®¡å½“å‰ç›®å½•ä¸‹çš„ .py æ–‡ä»¶æ•°"

# ä½¿ç”¨å†…ç½®ç³»ç»Ÿä¿¡æ¯æŠ€èƒ½
trae "æˆ‘çš„æœºå™¨æ˜¯ä»€ä¹ˆé…ç½®"

# è¿½é—®ä¸Šä¸€æ¡å‘½ä»¤åšäº†ä»€ä¹ˆ
trae "ä½ åˆšæ‰æ‰§è¡Œäº†ä»€ä¹ˆå‘½ä»¤"
```

å…¸å‹è¾“å‡ºï¼š

```text
ç†è§£ä¸­: å¸®æˆ‘æŸ¥è¯¢å†…å­˜ä½¿ç”¨æƒ…å†µ

è¡ŒåŠ¨è§„åˆ’: ä½¿ç”¨ free -h æŸ¥çœ‹å†…å­˜åˆ©ç”¨ç‡

ç”Ÿæˆçš„å‘½ä»¤: free -h

æ‰§è¡Œä¸­...
(å‘½ä»¤è¾“å‡º)

æ€»ç»“: ç³»ç»Ÿå…±æœ‰ 16Gi å†…å­˜ï¼Œç›®å‰ä½¿ç”¨çº¦ 4Giï¼Œå‰©ä½™ç©ºé—´å……è¶³ã€‚
```

---

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ |
| --- | --- |
| `query` | å¿…å¡«ï¼Œè‡ªç„¶è¯­è¨€æè¿°ï¼Œå¯åŒ…å«ç©ºæ ¼ã€‚ |
| `--dry-run` | åªæ‰“å°ç”Ÿæˆçš„å‘½ä»¤ä¸è§„åˆ’ï¼Œä¸æ‰§è¡Œã€‚ |
| `--api-key` | ä¸´æ—¶è¦†ç›–é…ç½®ä¸­çš„ API Keyã€‚ |
| `--provider` | é€‰æ‹© LLM æä¾›å•†ï¼š`openai` / `anthropic` / `qwen` / `dashscope` / `local`ã€‚ |
| `--model` | æŒ‡å®šæ¨¡å‹åç§°ï¼ˆå¦‚ `gpt-4o-mini`ã€`claude-3-sonnet`ã€`qwen-max`ã€`llama2`ï¼‰ã€‚ |
| `--context-window` | è°ƒæ•´å†å²æ¡æ•°ï¼ˆâ‰¥1ï¼‰ã€‚ |

å‘½ä»¤è¡Œä¼˜å…ˆçº§ > ç¯å¢ƒå˜é‡ > `~/.trae/config.json` é»˜è®¤å€¼ã€‚

---

## é…ç½®ä¸ç¯å¢ƒå˜é‡

### ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

```bash
export TRAE_API_KEY="sk-xxx"
export TRAE_PROVIDER="qwen"            # openai / anthropic / qwen / dashscope / local
export TRAE_MODEL="qwen3-max"
export TRAE_CONTEXT_WINDOW="50"
export TRAE_CONTEXT_OUTPUT_LIMIT="2000"
export TRAE_HISTORY_PATH="$HOME/.trae/history.jsonl"   # å¯é€‰
export TRAE_DEBUG=1                                  # æ‰“å°æ›´å¤šè°ƒè¯•ä¿¡æ¯
```

### é…ç½®æ–‡ä»¶

`~/.trae/config.json`ï¼ˆè‡ªåŠ¨åˆ›å»ºç›®å½•ï¼‰ï¼š

```json
{
  "api_key": "sk-xxx",
  "provider": "openai",
  "model": "gpt-4o-mini",
  "context_window": 50,
  "context_output_limit": 2000,
  "command_timeout": 30,
  "ollama_url": "http://localhost:11434/api/generate"
}
```

### CLI è¦†ç›–

```bash
trae --provider qwen --model qwen-max --api-key sk-dashscope "æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ç‡"
```

---

## LLM æä¾›å•†æ”¯æŒçŸ©é˜µ

| æä¾›å•† | ä¾èµ– | å¤‡æ³¨ |
| --- | --- | --- |
| OpenAI | `pip install openai` | ä½¿ç”¨ Chat Completions APIï¼›æ”¯æŒ GPT-3.5/4/4oã€‚ |
| Anthropic | `pip install anthropic` | ä½¿ç”¨ Claude Messages APIã€‚ |
| Qwen / DashScope | `pip install dashscope` | é€šè¿‡é˜¿é‡Œäº‘ DashScope æ¥å£ï¼›`TRAE_PROVIDER` å¯è®¾ä¸º `qwen` æˆ– `dashscope`ã€‚ |
| æœ¬åœ°æ¨¡å‹ (Ollama) | `pip install requests`ï¼Œæœ¬åœ°è¿è¡Œ Ollama | é€šè¿‡ `ollama_url` è°ƒç”¨ `POST /api/generate`ï¼›`TRAE_API_KEY` å¯ä¸ºå ä½å€¼ã€‚ |

å°šæœªæä¾›çš„æ¨¡å‹å¯é€šè¿‡æ‰©å±• `LLMClient` æ·»åŠ ã€‚

---

## å†…ç½®æŠ€èƒ½ä¸å®‰å…¨æœºåˆ¶

### æŠ€èƒ½åˆ—è¡¨ï¼ˆè§ `trae/skills.py`ï¼‰

- **SystemInfoSkill**ï¼šæ— éœ€ LLMï¼Œå³å¯è¾“å‡º CPU/å†…å­˜/GPU/ç£ç›˜è¡¨æ ¼ã€‚
- **MysqlInfoSkill**ï¼šæ£€æµ‹å« â€œmysqlâ€ çš„é—®é¢˜æ—¶ä¸»åŠ¨æç¤ºéœ€æä¾›å‡­æ®ï¼Œé¿å…ç›²è¿ã€‚
- **FollowupAnalysisSkill**ï¼šç†è§£â€œå¤Ÿç”¨å—â€â€œä¸Šä¸€æ¡å‘½ä»¤åšäº†ä»€ä¹ˆâ€â€œå¸®æˆ‘åˆ†æä¸€ä¸‹â€ç­‰è¿½é—®å¹¶å¼•ç”¨æœ€è¿‘å†å²ã€‚

æŠ€èƒ½å…ˆäº LLM è§¦å‘ï¼Œå¯ç¦»çº¿è¿è¡Œä¸”å…·ç¡®å®šæ€§ã€‚

### å±é™©å‘½ä»¤é˜²æŠ¤

- `rm -rf`, `dd if=`, `mkfs`, `fdisk`, `/dev/` é‡å®šå‘ã€`| sh` / `| bash` ç­‰éƒ½ä¼šè¢«æ ‡è®°ã€‚
- æ£€æµ‹åˆ°å±é™©å‘½ä»¤æ—¶ä¼šæç¤º `æ˜¯å¦ç»§ç»­æ‰§è¡Œ (y/N)`ï¼Œé»˜è®¤å–æ¶ˆã€‚

---

## ä¸Šä¸‹æ–‡è®°å¿†

- ç”± `ContextManager` è´Ÿè´£ï¼Œå°†äº¤äº’å†™å…¥ `~/.trae/history.jsonl`ã€‚
- æ¯æ¡è®°å½•åŒ…å« `query`ã€`command`ã€`output`ï¼ˆæˆªæ–­ï¼‰ã€‚
- `context_window` æ§åˆ¶ä¿å­˜æ¡æ•°ï¼Œ`context_output_limit` æ§åˆ¶æ¯æ¡è¾“å‡ºä¸Šé™ï¼Œè¶…è¿‡åä»¥ `...\n` è¿æ¥å‰åç‰‡æ®µã€‚
- éœ€è¦æ¸…ç©ºå†å²æ—¶åˆ é™¤æ–‡ä»¶æˆ–è®¾ç½®æ–°çš„ `history_file` è·¯å¾„å³å¯ã€‚

---

## æ„å»ºä¸å‘å¸ƒ

æ“ä½œç³»ç»Ÿå®šä½ä¸º Debian/Ubuntuï¼Œæ ¸å¿ƒä»»åŠ¡é›†ä¸­åœ¨ `Makefile`ï¼š

1. **æ£€æŸ¥ä¾èµ–**

   ```bash
   make check-deps
   ```

   è‹¥ç¼ºä¾èµ–ä¼šç»™å‡ºä¸€é”®å®‰è£…å‘½ä»¤ï¼š`sudo apt install devscripts debhelper python3-all python3-setuptools python3-pip dh-python`ã€‚

2. **æ„å»º**

   ```bash
   make deb          # ç­‰ä»·äº debuild -us -ucï¼Œå¹¶è‡ªåŠ¨æ£€æµ‹ debian/ ç›®å½•
   ```

3. **æ¸…ç†**

   ```bash
   make clean
   ```

4. **å¼€å‘å®‰è£… / Lint / Test**

   ```bash
   make install      # pip3 install -e .
   make lint         # flake8 trae/ ï¼ˆè‹¥å·²å®‰è£…ï¼‰
   make test         # ç›®å‰å ä½ï¼Œä½¿ç”¨ pytest tests/
   ```

Deb åŒ…ç”Ÿæˆåœ¨ä»“åº“ä¸Šä¸€çº§ç›®å½•ï¼Œå¦‚ `../trae_0.1.0-1_amd64.deb`ã€‚

---

## æµ‹è¯•ä¸è´¨é‡ä¿è¯

é¡¹ç›®é™„å¸¦ `test_trae.py`ï¼Œè¦†ç›–ï¼š

- é…ç½®åŠ è½½ï¼ˆ`get_config`ï¼‰
- ä»£ç†åˆå§‹åŒ–ä¸å±é™©å‘½ä»¤æ£€æµ‹
- ä¸Šä¸‹æ–‡è£å‰ªé€»è¾‘
- æŠ€èƒ½è·¯ç”±

è¿è¡Œï¼š

```bash
python3 test_trae.py
```

æ›´å¤šæµ‹è¯•å¯åœ¨ `tests/` ç›®å½•æ‰©å±•å¹¶é€šè¿‡ `pytest` æ‰§è¡Œã€‚

---

## æ•…éšœæ’é™¤

| ç—‡çŠ¶ | å¯èƒ½åŸå›  & è§£å†³æ–¹æ¡ˆ |
| --- | --- |
| `é”™è¯¯: æœªè®¾ç½® API å¯†é’¥` | é€šè¿‡ `TRAE_API_KEY` æˆ– `--api-key` æä¾›å¯†é’¥ã€‚ |
| `openai æ¨¡å—ä¸å­˜åœ¨` | è¿è¡Œ `pip install openai`ï¼Œå…¶å®ƒæä¾›å•†åŒç†ã€‚ |
| `bash: /usr/local/bin/trae: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶` | å®‰è£… Debian åŒ…åæ‰§è¡Œ `hash -r` æˆ–é‡æ–°å¼€ç»ˆç«¯ï¼Œç¡®ä¿ PATH ç¼“å­˜åˆ·æ–°ï¼ˆè¯¦è§ `QUICKSTART.md`ï¼‰ã€‚ |
| `å‘½ä»¤æ‰§è¡Œè¶…æ—¶/å¤±è´¥` | æŸ¥çœ‹ CLI è¾“å‡ºä¸ `~/.trae/history.jsonl`ï¼Œå¿…è¦æ—¶è®¾ç½® `TRAE_DEBUG=1` å¹¶é‡è¯•ã€‚ |
| `git push` å¤±è´¥ï¼ˆå¼€å‘è€…æƒ…æ™¯ï¼‰ | ç¡®è®¤ç½‘ç»œä»£ç†ä¸è¯ä¹¦ï¼Œæˆ–æ”¹ç”¨ SSH æ–¹å¼ã€‚ |

æ›´å¤šç»†èŠ‚è¯·æŸ¥é˜… `QUICKSTART.md` ä¸ `BUILD.md` çš„â€œæ•…éšœæ’é™¤â€ç« èŠ‚ã€‚

---

## é¡¹ç›®ç»“æ„

```text
trae/
â”œâ”€â”€ README.md               # æœ¬æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md           # å¿«é€Ÿå¼€å§‹
â”œâ”€â”€ BUILD.md                # æ‰“åŒ…/å‘å¸ƒç»†èŠ‚
â”œâ”€â”€ INSTALL.md / PROJECT_STRUCTURE.md / etc.
â”œâ”€â”€ Makefile
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ setup.py
â”œâ”€â”€ trae/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ agent.py
â”‚   â”œâ”€â”€ llm_client.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ history.py
â”‚   â””â”€â”€ skills.py
â”œâ”€â”€ debian/                 # æ§åˆ¶æ–‡ä»¶ã€postinstã€man page
â”œâ”€â”€ trae.1                  # man æ‰‹å†Œ
â””â”€â”€ test_trae.py
```

---

## è´¡çŒ®ä¸æ”¯æŒ

- æ¬¢è¿æäº¤ Issue / PRï¼š<https://github.com/812781385/trae/issues>
- æå‰è¯´æ˜ä½¿ç”¨åœºæ™¯ã€å¤ç°æ­¥éª¤ä¸æ—¥å¿—ï¼Œä¾¿äºå¿«é€Ÿå“åº”ã€‚
- æƒ³è¦è´¡çŒ®æ–°æŠ€èƒ½æˆ–æ–° LLM æä¾›å•†ï¼Ÿå¯å‚è€ƒ `SkillManager` ä¸ `LLMClient` çš„å®ç°ã€‚

---

## è®¸å¯è¯

æœ¬é¡¹ç›®åœ¨ [Apache License 2.0](LICENSE) ä¸‹å‘å¸ƒã€‚é™¤éå¦æœ‰è¯´æ˜ï¼Œæ‰€æœ‰è´¡çŒ®å‡é»˜è®¤éµå¾ªè¯¥è®¸å¯è¯ã€‚

---

æ„Ÿè°¢ä½ çš„å…³æ³¨ä¸è´¡çŒ®ï¼Œç¥ä½¿ç”¨æ„‰å¿«ï¼ ğŸ‰
